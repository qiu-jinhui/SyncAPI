# é¡¹ç›®ç»“æ„è¯´æ˜

## å·²åˆ›å»ºçš„æ–‡ä»¶å’Œç›®å½•

### ğŸ“ ç›®å½•ç»“æ„
```
synchronize_api/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½• (75ä¸ªPythonæ–‡ä»¶)
â”‚   â”œâ”€â”€ main.py                   # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config/                   # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ settings.py           # åº”ç”¨é…ç½®
â”‚   â”‚   â””â”€â”€ database.py           # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹ (9ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py               # åŸºç¡€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ project.py            # é¡¹ç›®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ use_case.py           # ç”¨ä¾‹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ budget.py             # é¢„ç®—æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ model.py              # æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ deployment.py         # éƒ¨ç½²æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ pricing.py            # å®šä»·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ subscription.py       # è®¢é˜…æ¨¡å‹
â”‚   â”‚   â””â”€â”€ limit.py              # é™åˆ¶æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/                  # APIæ¨¡å¼å®šä¹‰ (3ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ event_request.py      # äº‹ä»¶è¯·æ±‚æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ event_response.py     # äº‹ä»¶å“åº”æ¨¡å¼
â”‚   â”‚   â””â”€â”€ payloads.py           # è´Ÿè½½æ•°æ®æ¨¡å¼
â”‚   â”œâ”€â”€ repositories/             # æ•°æ®è®¿é—®å±‚ (9ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py               # åŸºç¡€ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ project_repository.py # é¡¹ç›®ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ use_case_repository.py # ç”¨ä¾‹ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ budget_repository.py  # é¢„ç®—ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ model_repository.py   # æ¨¡å‹ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ deployment_repository.py # éƒ¨ç½²ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ pricing_repository.py # å®šä»·ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ subscription_repository.py # è®¢é˜…ä»“å‚¨
â”‚   â”‚   â””â”€â”€ limit_repository.py   # é™åˆ¶ä»“å‚¨
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚ (4ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ sync_service.py       # åŒæ­¥æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ event_service.py      # äº‹ä»¶æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ model_garden_client.py # Model Gardenå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ redis_service.py      # RedisæœåŠ¡
â”‚   â”œâ”€â”€ api/                      # APIå±‚ (2ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dependencies.py       # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ v1/                   # APIç‰ˆæœ¬1
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ event_router.py   # äº‹ä»¶è·¯ç”±
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·æ¨¡å— (3ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validators.py         # éªŒè¯å·¥å…·
â”‚   â”‚   â””â”€â”€ helpers.py            # è¾…åŠ©å·¥å…·
â”‚   â””â”€â”€ tasks/                    # å®šæ—¶ä»»åŠ¡ (1ä¸ªæ–‡ä»¶)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ sync_scheduler.py     # åŒæ­¥è°ƒåº¦å™¨
â”œâ”€â”€ tests/                        # æµ‹è¯•ç›®å½• (24ä¸ªPythonæ–‡ä»¶)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py               # æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ test_main.py              # ä¸»åº”ç”¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_database.py          # æ•°æ®åº“æµ‹è¯•
â”‚   â”œâ”€â”€ run_tests.py              # æµ‹è¯•è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ test_models/              # æ¨¡å‹æµ‹è¯• (8ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_project.py
â”‚   â”‚   â”œâ”€â”€ test_use_case.py
â”‚   â”‚   â”œâ”€â”€ test_budget.py
â”‚   â”‚   â”œâ”€â”€ test_model.py
â”‚   â”‚   â”œâ”€â”€ test_deployment.py
â”‚   â”‚   â”œâ”€â”€ test_pricing.py
â”‚   â”‚   â”œâ”€â”€ test_subscription.py
â”‚   â”‚   â””â”€â”€ test_limit.py
â”‚   â”œâ”€â”€ test_repositories/        # ä»“å‚¨æµ‹è¯• (8ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_project_repository.py
â”‚   â”‚   â”œâ”€â”€ test_use_case_repository.py
â”‚   â”‚   â”œâ”€â”€ test_budget_repository.py
â”‚   â”‚   â”œâ”€â”€ test_model_repository.py
â”‚   â”‚   â”œâ”€â”€ test_deployment_repository.py
â”‚   â”‚   â”œâ”€â”€ test_pricing_repository.py
â”‚   â”‚   â”œâ”€â”€ test_subscription_repository.py
â”‚   â”‚   â””â”€â”€ test_limit_repository.py
â”‚   â”œâ”€â”€ test_services/            # æœåŠ¡æµ‹è¯• (4ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_sync_service.py
â”‚   â”‚   â”œâ”€â”€ test_event_service.py
â”‚   â”‚   â”œâ”€â”€ test_model_garden_client.py
â”‚   â”‚   â””â”€â”€ test_redis_service.py
â”‚   â””â”€â”€ test_api/                 # APIæµ‹è¯• (1ä¸ªæ–‡ä»¶)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ test_event_router.py
â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§» (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ versions/                 # è¿ç§»ç‰ˆæœ¬ç›®å½•
â”‚   â”œâ”€â”€ env.py                    # è¿ç§»ç¯å¢ƒ
â”‚   â”œâ”€â”€ script.py.mako            # è¿ç§»æ¨¡æ¿
â”‚   â””â”€â”€ alembic.ini               # Alembicé…ç½®
â”œâ”€â”€ docker/                       # Dockeré…ç½® (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ Dockerfile                # åº”ç”¨Dockerfile
â”‚   â”œâ”€â”€ docker-compose.yml        # å¼€å‘ç¯å¢ƒ
â”‚   â””â”€â”€ docker-compose.prod.yml   # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ scripts/                      # è„šæœ¬æ–‡ä»¶ (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ setup.sh                  # ç¯å¢ƒè®¾ç½®è„šæœ¬
â”‚   â”œâ”€â”€ migrate.sh                # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â””â”€â”€ deploy.sh                 # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ .gitignore                    # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ pyproject.toml                # Poetryé…ç½®
â”œâ”€â”€ requirements.txt              # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ PROJECT_STRUCTURE.md          # é¡¹ç›®ç»“æ„è¯´æ˜
â””â”€â”€ docker-compose.yml            # æœ¬åœ°å¼€å‘ç¯å¢ƒ
```

### ğŸ“Š æ–‡ä»¶ç»Ÿè®¡
- **æ€»æ–‡ä»¶æ•°**: 92ä¸ªæ–‡ä»¶
- **Pythonæ–‡ä»¶**: 75ä¸ª
- **é…ç½®æ–‡ä»¶**: 17ä¸ª
- **ç›®å½•æ•°**: 20ä¸ª

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

1. **æ•°æ®æ¨¡å‹å±‚** (`src/models/`)
   - 8ä¸ªæ•°æ®æ¨¡å‹ï¼Œå¯¹åº”æ•°æ®åº“è¡¨ç»“æ„
   - åŸºç¡€æ¨¡å‹æä¾›é€šç”¨å­—æ®µå’Œæ–¹æ³•

2. **APIæ¨¡å¼å±‚** (`src/schemas/`)
   - äº‹ä»¶è¯·æ±‚æ¨¡å¼ï¼šæ¥æ”¶Model Gardençš„CUDäº‹ä»¶
   - äº‹ä»¶å“åº”æ¨¡å¼ï¼šè¿”å›å¤„ç†ç»“æœ
   - è´Ÿè½½æ•°æ®æ¨¡å¼ï¼šå®šä¹‰å„ç§å®ä½“ç±»å‹çš„æ•°æ®ç»“æ„

3. **æ•°æ®è®¿é—®å±‚** (`src/repositories/`)
   - 8ä¸ªä»“å‚¨ç±»ï¼Œå¯¹åº”æ¯ä¸ªæ•°æ®æ¨¡å‹
   - åŸºç¡€ä»“å‚¨æä¾›é€šç”¨CRUDæ“ä½œ

4. **ä¸šåŠ¡é€»è¾‘å±‚** (`src/services/`)
   - åŒæ­¥æœåŠ¡ï¼šå¤„ç†ä»Model Gardenè·å–çš„æ•°æ®
   - äº‹ä»¶æœåŠ¡ï¼šå¤„ç†CUDäº‹ä»¶
   - Model Gardenå®¢æˆ·ç«¯ï¼šè°ƒç”¨å¤–éƒ¨API
   - RedisæœåŠ¡ï¼šç¼“å­˜å’Œäº‹ä»¶å‘å¸ƒ

5. **APIå±‚** (`src/api/`)
   - äº‹ä»¶è·¯ç”±ï¼š`/api/v1/model-garden/events` (æ¥æ”¶Model Gardenäº‹ä»¶)
   - å¥åº·æ£€æŸ¥ï¼š`/api/v1/model-garden/health`
   - ä¾èµ–æ³¨å…¥é…ç½®

6. **å·¥å…·æ¨¡å—** (`src/utils/`)
   - æ—¥å¿—å·¥å…·ï¼šç»“æ„åŒ–æ—¥å¿—
   - éªŒè¯å·¥å…·ï¼šæ•°æ®éªŒè¯
   - è¾…åŠ©å·¥å…·ï¼šé€šç”¨åŠŸèƒ½

7. **å®šæ—¶ä»»åŠ¡** (`src/tasks/`)
   - åŒæ­¥è°ƒåº¦å™¨ï¼šå®šæ—¶è°ƒç”¨Model Gardençš„ `/model-garden/sync/all` API

### ğŸ§ª æµ‹è¯•ç»“æ„

1. **æ¨¡å‹æµ‹è¯•** (`tests/test_models/`)
   - 8ä¸ªæ¨¡å‹æµ‹è¯•æ–‡ä»¶
   - æ•°æ®éªŒè¯å’Œå…³ç³»æµ‹è¯•

2. **ä»“å‚¨æµ‹è¯•** (`tests/test_repositories/`)
   - 8ä¸ªä»“å‚¨æµ‹è¯•æ–‡ä»¶
   - CRUDæ“ä½œå’Œäº‹åŠ¡æµ‹è¯•

3. **æœåŠ¡æµ‹è¯•** (`tests/test_services/`)
   - 4ä¸ªæœåŠ¡æµ‹è¯•æ–‡ä»¶
   - ä¸šåŠ¡é€»è¾‘å’Œå¤–éƒ¨APIè°ƒç”¨æµ‹è¯•

4. **APIæµ‹è¯•** (`tests/test_api/`)
   - 1ä¸ªAPIæµ‹è¯•æ–‡ä»¶
   - äº‹ä»¶æ¥æ”¶ç«¯ç‚¹æµ‹è¯•

### ğŸ³ éƒ¨ç½²é…ç½®

1. **Dockeré…ç½®**
   - å¤šé˜¶æ®µæ„å»ºçš„Dockerfile
   - å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„docker-composeæ–‡ä»¶

2. **è„šæœ¬æ–‡ä»¶**
   - ç¯å¢ƒè®¾ç½®è„šæœ¬
   - æ•°æ®åº“è¿ç§»è„šæœ¬
   - éƒ¨ç½²è„šæœ¬

### ğŸ“‹ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

1. **å®ç°æ•°æ®æ¨¡å‹** - æ ¹æ®æ•°æ®åº“schemaå®šä¹‰æ‰€æœ‰æ¨¡å‹
2. **å®ç°APIæ¨¡å¼** - å®Œå–„äº‹ä»¶è¯·æ±‚å“åº”æ¨¡å¼
3. **å®ç°ä»“å‚¨å±‚** - æ•°æ®è®¿é—®å’ŒCRUDæ“ä½œ
4. **å®ç°æœåŠ¡å±‚** - ä¸šåŠ¡é€»è¾‘å’Œå¤–éƒ¨APIè°ƒç”¨
5. **å®ç°APIè·¯ç”±** - å®Œå–„äº‹ä»¶æ¥æ”¶ç«¯ç‚¹
6. **å®ç°æµ‹è¯•** - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€APIæµ‹è¯•
7. **é…ç½®éƒ¨ç½²** - DockeråŒ–å’Œç”Ÿäº§ç¯å¢ƒé…ç½®

### ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd synchronize_api

# è¿è¡Œç¯å¢ƒè®¾ç½®è„šæœ¬
./scripts/setup.sh

# é…ç½®ç¯å¢ƒå˜é‡
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# è¿è¡Œæ•°æ®åº“è¿ç§»
./scripts/migrate.sh

# å¯åŠ¨åº”ç”¨
poetry run uvicorn src.main:app --reload
```

### ğŸ”„ APIè°ƒç”¨å…³ç³»

1. **Sync API â†’ Model Garden**: å®šæ—¶è°ƒç”¨ `/model-garden/sync/all` è·å–å…¨é‡æ•°æ®
2. **Model Garden â†’ Sync API**: å®æ—¶è°ƒç”¨ `/api/v1/model-garden/events` å‘é€CUDäº‹ä»¶

é¡¹ç›®ç»“æ„å·²æ ¹æ®æ­£ç¡®çš„APIè°ƒç”¨å…³ç³»è°ƒæ•´å®Œæˆï¼Œæ‰€æœ‰å¿…è¦çš„æ–‡ä»¶å’Œç›®å½•éƒ½å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å…·ä½“çš„ä»£ç å®ç°äº†ã€‚ 